<!DOCTYPE html>
<html>
    <head>
        <title>åŒé”‹å¯¹å†³</title>
        <link rel = "stylesheet" href = "../styles/new.css"/>
        <link rel = "icon" href = "../favicon.ico" type = "image/x-icon" />
        <script src="../scripts/jquery.min.js"></script>

        <script>
            // æ£€æŸ¥jQueryæ˜¯å¦åŠ è½½æˆåŠŸ
            if (typeof $ !== 'undefined') {
                console.log('jQuery is loaded successfully');
            } else {
                console.error('jQuery is not loaded');
            }
        </script>
        <!-- Supabaseå®¢æˆ·ç«¯åº“ -->
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
        <!-- Supabaseæ•°æ®åº“è¿æ¥ -->
        <script src="../scripts/supabase.js"></script>
        <!-- æ¸¸æˆæ•°æ®ç®¡ç†å™¨ -->
        <script src="../scripts/game-data-manager.js"></script>
        <!-- æ¸¸æˆæ•°æ®é›†æˆ -->
        <script src="../scripts/game-integration.js"></script>
    </head>
    <body>
        <div class = "map">
            <div id="artBox">
                <div id="leftHouse"></div>
                <div id="rightHouse"></div>
                <div id="back"></div>
            </div>
            <div class = "man one"></div>
            <div class = "man two"></div>
            <div class = "line oo"></div>
            <div class = "line tt"></div>
            <div class = "meteor"></div>
            <div class = "shielding"></div>
            <div class = "ground bottom"></div>
            <div class = "ground left"></div>
            <div class = "ground right"></div>
            <div class = "sign Ma"></div>
            <div class = "sign Me"></div>
            <div id="bulletBox"></div>
            <div id="speedTip"></div>
            <div id="bloodBox">
                <div></div>
            </div>
            <div class = "medical kit"></div>
            <div class = "medical bottle"></div>
            <div id="aiBox"></div>
            <div id="fireBox"></div>
            <div class = "gg">
                <p class = "winner"></p>
                <video id="mageWinVideo" class="win-video" autoplay loop muted>
                    <source src="../assets/images/mageVictory.mp4" type="video/mp4">
                </video>
                <video id="mechanicianWinVideo" class="win-video" autoplay loop muted>
                    <source src="../assets/images/mechanician.mp4" type="video/mp4">
                </video>
            </div>
            <div class = "start">Round 1</div>
        <div class = "round-info">
            <span class="round-number">ç¬¬ 1/3 å›åˆ</span> | 
            <span class="map-name">è¯·é€‰æ‹©åœ°å›¾</span>
        </div>
        </div>
        
        <div class = "health B1">
            <div class = "H1 h10"></div>
            <div class = "H1 shield"></div>
            <div class = "H1 h11"></div>
        </div>
        <div class = "health B2">
            <div class = "H2 h20"></div>
            <div class = "H2 h21"></div>
        </div>

        <div class = "energy Mag">
            <div class = "En1 enLine"></div>
        </div>
        <div class = "energy Mech">
            <div class = "En2 enLine"></div>
        </div>
        <div id = "sound">
            <audio class = "MageAudio">
                <source src="../assets/sounds/characters/mage/fireAtk.mp3" type="audio/mpeg" /><!--0-->
            </audio>
            <audio class = "MageAudio">
                <source src="../assets/sounds/characters/mage/fireboom.mp3" type="audio/mpeg" /><!--1-->
            </audio>
            <audio class = "MageAudio">
                <source src="../assets/sounds/characters/mage/mage.ah1.mp3" type="audio/mpeg" /><!--2-->
            </audio>
            <audio class = "MageAudio">
                <source src="../assets/sounds/characters/mage/mage.ah2.mp3" type="audio/mpeg" /><!--3-->
            </audio>
            <audio class = "MageAudio">
                <source src="../assets/sounds/characters/mage/mage.ah3.mp3" type="audio/mpeg" /><!--4-->
            </audio>
            <audio class = "MageAudio">
                <source src="../assets/sounds/characters/mage/mageDie.mp3" type="audio/mpeg" /><!--5-->
            </audio>
            <audio class = "MageAudio">
                <source src="../assets/sounds/characters/mage/mageWin.mp3" type="audio/mpeg" /><!--6-->
            </audio>
            <audio class = "MageAudio">
                <source src="../assets/sounds/characters/mage/servant.die.mp3" type="audio/mpeg" /><!--7-->
            </audio>
            <audio class = "MageAudio">
                <source src="../assets/sounds/characters/mage/servant.say.mp3" type="audio/mpeg" /><!--8-->
            </audio>
            <audio class = "MageAudio">
                <source src="../assets/sounds/characters/mage/yes.my.mp3" type="audio/mpeg" /><!--9-->
            </audio>
            <audio class = "MageAudio">
                <source src="../assets/sounds/characters/mage/tinyfire.mp3" type="audio/mpeg" /><!--10-->
            </audio>
            <audio class = "MageAudio">
                <source src="../assets/sounds/characters/mage/stop.mp3" type="audio/mpeg" /><!--11-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/boom.mp3" type="audio/mpeg" /><!--0-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/crazy.mp3" type="audio/mpeg" /><!--1-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/drone.mp3" type="audio/mpeg" /><!--2-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/droneboom.mp3" type="audio/mpeg" /><!--3-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/flash.mp3" type="audio/mpeg" /><!--4-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/grenade.mp3" type="audio/mpeg" /><!--5-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/mechDie.mp3" type="audio/mpeg" /><!--6-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/mechhurt1.mp3" type="audio/mpeg" /><!--7-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/mechhurt2.mp3" type="audio/mpeg" /><!--8-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/mechhurt3.mp3" type="audio/mpeg" /><!--9-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/mechWin.mp3" type="audio/mpeg" /><!--10-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/reload.mp3" type="audio/mpeg" /><!--11-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/reloadFast.mp3" type="audio/mpeg" /><!--12-->
            </audio>
            <audio class = "MechAudio">
                <source src="../assets/sounds/characters/mech/walk.mp3" type="audio/mpeg" /><!--13-->
            </audio>
            <audio class = "healAudio">
                <source src="../assets/sounds/effects/heal.mp3" type="audio/mpeg" />
            </audio>
            <audio class = "roundAudio">
                <source src="../assets/sounds/effects/round1.mp3" type="audio/mpeg" />
            </audio>
            <audio class = "roundAudio">
                <source src="../assets/sounds/effects/round2.mp3" type="audio/mpeg" />
            </audio>
            <audio class = "roundAudio">
                <source src="../assets/sounds/effects/round3.mp3" type="audio/mpeg" />
            </audio>
            <audio class = "roundAudio">
                <source src="../assets/sounds/effects/fight.mp3" type="audio/mpeg" />
             </audio>
            <audio class = "roundAudio">
                <source src="../assets/sounds/effects/fight.mp3" type="audio/mpeg" />
              </audio>
            <audio class = "roundAudio">
                <source src="../assets/sounds/effects/fight.mp3" type="audio/mpeg" />
               </audio>
            <audio class = "roundAudio">
                <source src="../assets/sounds/effects/fight.mp3" type="audio/mpeg" />
               </audio>
            <audio class = "BGM" loop>
                <source src="../assets/sounds/bgm/BGM1.mp3" type="audio/mpeg" />
              </audio>
            <audio class = "BGM" loop>
                <source src="../assets/sounds/bgm/BGM6.mp3" type="audio/mpeg" />
               </audio>
            <audio class = "BGM" loop>
                <source src="../assets/sounds/bgm/BGM2.mp3" type="audio/mpeg" />
               </audio>
            <audio class = "BGM" loop>
                <source src="../assets/sounds/bgm/BGM3.mp3" type="audio/mpeg" />
                </audio>
            <audio class = "BGM" loop>
                <source src="../assets/sounds/bgm/BGM4.mp3" type="audio/mpeg" />
                </audio>
            <audio class = "BGM" loop>
                <source src="../assets/sounds/bgm/BGM5.mp3" type="audio/mpeg" />
                </audio>
            <!-- ä¸»é¡µé¢èƒŒæ™¯éŸ³é¢‘ -->
            <audio id="mainMenuBGM" loop preload="auto">
                <source src="../assets/sounds/effects/mainMusic.mp3" type="audio/mpeg" />
             </audio>
        </div>

        
        

        
        <!-- æ¸¸æˆä¸»ç•Œé¢ -->
        <div class="game-main-menu" id="gameMainMenu">
        <script>
            // ä½¿ç”¨çº¯JavaScriptæ·»åŠ æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.addEventListener('DOMContentLoaded', function() {
                
                // æ’è¡Œæ¦œæŒ‰é’®
                const leaderboardBtn = document.getElementById('leaderboardBtn');
                if (leaderboardBtn) {
                    leaderboardBtn.addEventListener('click', function() {
                        console.log('æ’è¡Œæ¦œæŒ‰é’®é€šè¿‡çº¯JavaScriptè¢«ç‚¹å‡»');
                        window.location.href = './leaderboard.html';
                    });
                } else {
                    console.error('æ’è¡Œæ¦œæŒ‰é’®å…ƒç´ æœªæ‰¾åˆ°');
                }
                
                // ä¸ªäººä¿¡æ¯æŒ‰é’®
                const userInfoBtn = document.getElementById('userInfoBtn');
                if (userInfoBtn) {
                    userInfoBtn.addEventListener('click', function() {
                        console.log('ä¸ªäººä¿¡æ¯æŒ‰é’®é€šè¿‡çº¯JavaScriptè¢«ç‚¹å‡»');
                        window.location.href = './userinfo.html';
                    });
                } else {
                    console.error('ä¸ªäººä¿¡æ¯æŒ‰é’®å…ƒç´ æœªæ‰¾åˆ°');
                }
                

                
                // é€‰æ‹©åœ°å›¾æŒ‰é’®
                const mapSelectionBtn = document.getElementById('mapSelectionBtn');
                if (mapSelectionBtn) {
                    mapSelectionBtn.addEventListener('click', function() {
                        console.log('é€‰æ‹©åœ°å›¾æŒ‰é’®é€šè¿‡çº¯JavaScriptè¢«ç‚¹å‡»');
                        const gameMainMenu = document.getElementById('gameMainMenu');
                        const mapSelection = document.getElementById('mapSelection');
                        if (gameMainMenu && mapSelection) {
                            gameMainMenu.style.display = 'none';
                            mapSelection.style.display = 'block';
                        }
                    });
                } else {
                    console.error('é€‰æ‹©åœ°å›¾æŒ‰é’®å…ƒç´ æœªæ‰¾åˆ°');
                }
                
                // è¿”å›ç™»å½•æŒ‰é’®
                const backToLoginBtn = document.getElementById('backToLoginBtn');
                if (backToLoginBtn) {
                    backToLoginBtn.addEventListener('click', function() {
                        console.log('è¿”å›ç™»å½•æŒ‰é’®é€šè¿‡çº¯JavaScriptè¢«ç‚¹å‡»');
                        window.location.href = '../index.html';
                    });
                } else {
                    console.error('è¿”å›ç™»å½•æŒ‰é’®å…ƒç´ æœªæ‰¾åˆ°');
                }
                
                // æ¸¸æˆå¸®åŠ©æŒ‰é’®
                const helpBtn = document.getElementById('helpBtnFromMain');
                if (helpBtn) {
                    helpBtn.addEventListener('click', function() {
                        console.log('æ¸¸æˆå¸®åŠ©æŒ‰é’®é€šè¿‡çº¯JavaScriptè¢«ç‚¹å‡»');
                        window.location.href = './help.html';
                    });
                } else {
                    console.error('æ¸¸æˆå¸®åŠ©æŒ‰é’®å…ƒç´ æœªæ‰¾åˆ°');
                }
                
                // è¿”å›æŒ‰é’®
                const backBtn = document.getElementById('backButton');
                if (backBtn) {
                    backBtn.addEventListener('click', function() {
                        console.log('è¿”å›æŒ‰é’®é€šè¿‡çº¯JavaScriptè¢«ç‚¹å‡»');
                        window.history.back();
                    });
                } else {
                    console.error('è¿”å›æŒ‰é’®å…ƒç´ æœªæ‰¾åˆ°');
                }
                
                // éŸ³é‡æ§åˆ¶åŠŸèƒ½
                const volumeIcon = document.getElementById('volumeIcon');
                const volumeSlider = document.getElementById('volumeSlider');
                
                // è·å–æ‰€æœ‰éŸ³é¢‘å…ƒç´ 
                function getAllAudioElements() {
                    return document.querySelectorAll('audio');
                }
                
                // è®¾ç½®æ‰€æœ‰éŸ³é¢‘çš„éŸ³é‡
                function setAllAudioVolume(volume) {
                    const audioElements = getAllAudioElements();
                    audioElements.forEach(audio => {
                        audio.volume = volume / 100;
                    });
                }
                
                // åˆå§‹åŒ–éŸ³é‡
                const initialVolume = volumeSlider.value;
                setAllAudioVolume(initialVolume);
                
                // éŸ³é‡æ»‘å—äº‹ä»¶
                if (volumeSlider) {
                    volumeSlider.addEventListener('input', function() {
                        const volume = this.value;
                        setAllAudioVolume(volume);
                        
                        // æ›´æ–°éŸ³é‡å›¾æ ‡
                        if (volumeIcon) {
                            if (volume === '0') {
                                volumeIcon.textContent = 'ğŸ”‡';
                            } else if (volume < '30') {
                                volumeIcon.textContent = 'ğŸ”‰';
                            } else {
                                volumeIcon.textContent = 'ğŸ”Š';
                            }
                        }
                        
                        console.log('éŸ³é‡è®¾ç½®ä¸º:', volume);
                    });
                }
                
                // éŸ³é‡å›¾æ ‡ç‚¹å‡»äº‹ä»¶ï¼ˆé™éŸ³/å–æ¶ˆé™éŸ³ï¼‰
                if (volumeIcon) {
                    volumeIcon.addEventListener('click', function() {
                        if (this.textContent === 'ğŸ”‡') {
                            // å–æ¶ˆé™éŸ³
                            this.textContent = 'ğŸ”Š';
                            if (volumeSlider) {
                                volumeSlider.value = '50';
                                setAllAudioVolume('50');
                            }
                        } else {
                            // é™éŸ³
                            this.textContent = 'ğŸ”‡';
                            if (volumeSlider) {
                                volumeSlider.value = '0';
                                setAllAudioVolume('0');
                            }
                        }
                    });
                }
            });
        </script>
            <!-- åŠ¨æ€èƒŒæ™¯è§†é¢‘ -->
            <video id="backgroundVideo" autoplay muted loop>
                <source src="../assets/images/mainImage.mp4" type="video/mp4">
                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
            </video>
            <div class="main-menu-content">
                <div class="main-menu-header">
                    <img src="../assets/images/logo.png" alt="åŒé”‹å¯¹å†³" class="game-logo">
                    <p>ä¸‰å±€ä¸¤èƒœåˆ¶å¯¹å†³</p>
                </div>
                <div class="main-menu-body">
                    <button class="main-menu-button primary" id="mapSelectionBtn">é€‰æ‹©åœ°å›¾</button>
                    <button class="main-menu-button secondary" id="leaderboardBtn">æ’è¡Œæ¦œ</button>
                    <button class="main-menu-button secondary" id="userInfoBtn">ä¸ªäººä¿¡æ¯</button>
                    <button class="main-menu-button secondary" id="helpBtnFromMain">æ¸¸æˆå¸®åŠ©</button>
                    <button class="main-menu-button secondary" id="backToLoginBtn">è¿”å›ç™»å½•</button>
                </div>
            </div>
        </div>
        
        <div class = "map-selection" id="mapSelection">
            <div class="map-selection-content">
                <div class="map-selection-header">
                    <h2>é€‰æ‹©åœ°å›¾</h2>
                    <p>é€‰æ‹©ä¸€ä¸ªåœ°å›¾è¿›è¡Œä¸‰å±€ä¸¤èƒœçš„å¯¹å†³</p>
                </div>
                <div class="map-selection-body">
                    <div class="map-grid">
                        <div class="map-item" data-map="0">
                            <div class="map-preview" style="background-image: url(../assets/images/backgrounds/background1.png)"></div>
                            <div class="map-name">åŸé•‡å¹¿åœº</div>
                        </div>
                        <div class="map-item" data-map="1">
                            <div class="map-preview" style="background-image: url(../assets/images/backgrounds/background2.png)"></div>
                            <div class="map-name">å³­å£ä¹‹æˆ˜</div>
                        </div>
                        <div class="map-item" data-map="2">
                            <div class="map-preview" style="background-image: url(../assets/images/backgrounds/background3.png)"></div>
                            <div class="map-name">åœ°ä¸‹çŸ¿äº•</div>
                        </div>
                        <div class="map-item" data-map="3">
                            <div class="map-preview" style="background-image: url(../assets/images/backgrounds/background4.png)"></div>
                            <div class="map-name">å¤©ç©ºä¹‹åŸ</div>
                        </div>
                        <div class="map-item" data-map="4">
                            <div class="map-preview" style="background-image: url(../assets/images/backgrounds/background5.png)"></div>
                            <div class="map-name">ç«å±±ç†”å²©</div>
                        </div>
                        <div class="map-item" data-map="5">
                            <div class="map-preview" style="background-image: url(../assets/images/backgrounds/background6.png)"></div>
                            <div class="map-name">å†°é›ªè¦å¡</div>
                        </div>
                    </div>
                </div>
                <div class="map-selection-footer">
                    <button class="main-menu-button secondary" id="backFromMapSelectionBtn">è¿”å›ä¸»èœå•</button>
                </div>
            </div>
        </div>
        

        

        
        <!-- è¿”å›æŒ‰é’® -->
        <div class="exit-button" id="backButton">è¿”å›</div>
        
        <!-- éŸ³é‡æ§åˆ¶ç»„ä»¶ -->
        <div class="volume-control">
            <div class="volume-icon" id="volumeIcon">ğŸ”Š</div>
            <input type="range" id="volumeSlider" min="0" max="100" value="50" class="volume-slider">
        </div>
        
        <!-- åŠ è½½é¡µé¢ -->
        <div class="loading-page" id="loadingPage">
            <!-- åŠ è½½é¡µé¢è§†é¢‘èƒŒæ™¯ -->
            <video id="loadingBackgroundVideo" autoplay muted loop>
                <source src="../assets/images/mainImage.mp4" type="video/mp4">
                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
            </video>
            <div class="loading-content">
                <div class="loading-text">æ­£åœ¨åŠ è½½æ¸¸æˆ...</div>
                <div class="loading-bar-container">
                    <div class="loading-bar" id="loadingBar"></div>
                </div>
                <div class="loading-percentage" id="loadingPercentage">0%</div>
            </div>
        </div>

        <script src ="../scripts/control.js"></script>

    </body>
</html>